<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="description" content="">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">


<meta name="keywords" content="protractor, testing, ">

 
<meta property="og:type" content="article"/>
<meta property="og:description" content=""/>
<meta property="og:title" content="Running Protractor scenarios in parallel : github.orlade.io"/>
<meta property="og:site_name" content="Oliver Lade"/>
<meta property="og:image" content="" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="" />
<meta property="og:image:height" content="" />
<meta property="og:url" content="http://orlade.github.io/2015/09/protractor-scenarios-parallel/">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2015-09-20"/>
<meta property="article:modified_time" content="2015-09-20"/>


<meta property="article:tag" content="protractor">
<meta property="article:tag" content="testing">



  <title> Running Protractor scenarios in parallel &middot; Software adventures and thoughts </title>

  
  <link rel="stylesheet" href="http://orlade.github.io/css/poole.css">
  <link rel="stylesheet" href="http://orlade.github.io/css/syntax.css">
  <link rel="stylesheet" href="http://orlade.github.io/css/hyde.css">
  <link rel="stylesheet" href="http://orlade.github.io/css/categories.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <link href='http://fonts.googleapis.com/css?family=Raleway:400,300' rel='stylesheet' type='text/css'>

  
  <link href="" rel="alternate" type="application/rss+xml" title="Software adventures and thoughts" />

  
  <script src="//ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js"></script>
  

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</head>

<body>
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1 class="brand"><a href="http://orlade.github.io">Oliver Lade</a></h1>
      <p class="lead">
       Software adventures and thoughts 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="/">Home</a></li>
      
      <li><a href="/about/">About </a></li>
      
      
      <li><a href="/projects">Projects</a></li>
      <li><a href="/ideas">Ideas</a></li>
    </ul>
      <a href="https://au.linkedin.com/in/oliverlade"><i class="fa fa-linkedin"></i></a>&nbsp;&nbsp;
      <a href="http://www.orlade.github.io"><i class="fa fa-link"></i></a>&nbsp;&nbsp;
      
      
      <a href="https://github.com/orlade"><i class="fa fa-github"></i></a>&nbsp;&nbsp;
      
      <a href="http://orlade.github.io/index.xml"><i class="fa fa-rss"></i></a>&nbsp;&nbsp;

    <p class="footnote">powered by <a href="http://hugo.spf13.com">Hugo</a> <br/>
      &copy; 2016 Oliver Lade. All rights reserved.</p>
    
  </div>
</div>

  <div class="content container">
  <div class="post">
    <h1 class="post-title">Running Protractor scenarios in parallel</h1>
    <span class="post-date">Sun, Sep 20, 2015</span>
    

<div class="post-categories">
    
    <a class="post-category post-category-testing" href="http://orlade.github.io/categories/testing">testing</a>
    
</div>



    

<p>Protractor can run tests in parallel, but only one feature file per Selenium instance. If a single
feature file has more than one scenario, they cannot be parallelised out of the box.</p>

<p>One solution to run scenarios in parallel is to write each new scenario in a new <code>.feature</code> file.
However this breaks the natural grouping that feature files provide, and besides, it may already be
too late if your team has many multi-scenario features.</p>

<p>The alternative is to only &ldquo;flatten&rdquo; these scenarios into separate feature files just before running
Protractor, and then cleaning them up afterwards.</p>

<h1 id="the-process">The Process</h1>

<p>TODO: Walk through <code>flatten.js</code> and <code>flattener.js</code>.</p>

<h1 id="optimization">Optimization</h1>

<p>Okay, so we have improved our testing framework to run all of our scenarios in parallel, no matter
how we structure our feature files. But there is still room for improvement.</p>

<p>Protractor creates a new Selenium instance for each feature file that it processes. This means that
if you have a fixed maximum number of Selenium instances which is less than the number of scenarios,
simply flattening scenarios one per feature file will be inefficient: each of the instances will be
set up and torn down multiple times per run, incurring a few seconds of overhead each time.</p>

<p>The solution, given <em>N</em> maximum Selenium instances, is to pack the scenarios into <em>N</em> feature files.
This way, each Selenium instance will only be set up and torn down once.</p>

<p>New problem: packing scenarios naively (e.g. randomly) will be inefficient, since the test suite
will take as long as the longest-running feature file. Ideally, all feature files would take roughly
the same amount of time to run through all of their scenarios.</p>

<p>It is impossible to determine the optimal packing a priori, since individual steps can take vastly
different amounts of time, and even the same step may behave differently depending on application
context. As such, it is necessary to first run the tests, record the durations of each scenario, and
then use the duration data to pack scenarios so that the sums of the durations per feature file are
roughly equal (this is the multi-way number partitioning problem; see <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.150.2326&amp;rep=rep1&amp;type=pdf">Korf, 2009</a>).</p>

<p>This packing strategy may be customized to whatever environment you run your tests in. For example,
if you have heterogeneous hardware (some machines faster than others), you may be able to force
certain features to run on the slower machines, and pack fewer scenarios into them.</p>

    
<div class="social-sharing">
	<a class="share-button-facebook" onClick="return popupShare(this.href);" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2forlade.github.io%2f2015%2f09%2fprotractor-scenarios-parallel%2f" target="_blank"><i class="fa fa-facebook"><span>Like</span></i></a>
	<a class="share-button-google-plus" onClick="return popupShare(this.href);" href="https://plus.google.com/share?url=http%3a%2f%2forlade.github.io%2f2015%2f09%2fprotractor-scenarios-parallel%2f" target="_blank"><i class="fa fa-google-plus"><span>Google +1</span></i></a>
	<a class="share-button-linkedin" onClick="return popupShare(this.href);" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2forlade.github.io%2f2015%2f09%2fprotractor-scenarios-parallel%2f&title=Running%20Protractor%20scenarios%20in%20parallel&summary=Protractor%20can%20run%20tests%20in%20parallel%2c%20but%20only%20one%20feature%20file%20per%20Selenium%20instance.%20If%20a%20single%20feature%20file%20has%20more%20than%20one%20scenario%2c%20they%20cannot%20be%20parallelised%20out%20of%20the%20box.%0aOne%20solution%20to%20run%20scenarios%20in%20parallel%20is%20to%20write%20each%20new%20scenario%20in%20a%20new%20.feature%20file.%20However%20this%20breaks%20the%20natural%20grouping%20that%20feature%20files%20provide%2c%20and%20besides%2c%20it%20may%20already%20be%20too%20late%20if%20your%20team%20has%20many%20multi-scenario%20features.}&source=Software%20adventures%20and%20thoughts" target="_blank"><i class="fa fa-linkedin"><span>Share on LinkedIn</span></i></a>
	<a class="share-button-twitter" onClick="return popupShare(this.href);" href="http://twitter.com/share?text=Running%20Protractor%20scenarios%20in%20parallel&url=http%3a%2f%2forlade.github.io%2f2015%2f09%2fprotractor-scenarios-parallel%2f" target="_blank"><i class="fa fa-twitter"><span>Tweet</span></i></a>	
</div>
<script type="text/javascript">
    function popupShare(url) {
        window.open(url, '_blank', 'scrollbars,resizable,height=525,width=600');
        return false;
    }
</script>


    

<div class="tags-list">
    <span class="dark-red">Tags</span><span class="decorative-marker">#</span>
    
    <a class="post-tag post-tag-protractor" href="http://orlade.github.io/tags/protractor">protractor</a>,
    
    <a class="post-tag post-tag-testing" href="http://orlade.github.io/tags/testing">testing</a>,
    
</div>



    
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost") 
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'orlade';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the comments powered by <a href="http://disqus.com/?ref_noscript">Disqus.</a></noscript>


  </div>
  </div>
  </body>
</html>
